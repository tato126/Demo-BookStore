<!DOCTYPE html>
<html lang="ko" 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/admin-layout}">
<head>
    <title>상품 수정</title>
</head>
<body>
    <div layout:fragment="content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>상품 수정</h2>
            <button class="btn btn-secondary" onclick="history.back()">취소</button>
        </div>

        <form id="updateForm" th:action="@{/admin/product/update/{id}(id=${book?.bookId})}" method="post">
            <!-- 기본 정보 -->
            <div class="form-section">
                <h5 class="section-title">기본 정보</h5>
                <div class="row">
                    <div class="col-md-3">
                        <div class="product-image">
                            <span class="text-muted">상품 이미지</span>
                        </div>
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-outline-primary w-100">이미지 변경</button>
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">상품코드</label>
                                    <input type="text" class="form-control" name="bookId" th:value="${book?.bookId}" readonly>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">상품명</label>
                                    <input type="text" class="form-control" name="bookName" th:value="${book?.bookName}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">저자</label>
                                    <input type="text" class="form-control" name="author" th:value="${book?.author}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">출판사</label>
                                    <input type="text" class="form-control" name="publisher" th:value="${book?.publisher}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">ISBN</label>
                                    <input type="text" class="form-control" name="isbn" th:value="${book?.isbn}">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">카테고리</label>
                                    <select class="form-select" name="bookCategory">
                                        <option value="">카테고리 선택</option>
                                        <option th:selected="${book?.bookCategory == 'programming'}" value="programming">프로그래밍</option>
                                        <option th:selected="${book?.bookCategory == 'novel'}" value="novel">소설</option>
                                        <option th:selected="${book?.bookCategory == 'self-help'}" value="self-help">자기계발</option>
                                        <option th:selected="${book?.bookCategory == 'business'}" value="business">경제/경영</option>
                                        <option th:selected="${book?.bookCategory == 'science'}" value="science">과학</option>
                                        <option th:selected="${book?.bookCategory == 'history'}" value="history">역사</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">출간일</label>
                                    <input type="date" class="form-control" name="publishDate" th:value="${book?.publishDate}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 상품 설명 -->
            <div class="form-section">
                <h5 class="section-title">상품 설명</h5>
                <div class="mb-3">
                    <label class="form-label">상품 설명</label>
                    <textarea class="form-control" rows="5" name="explanation" th:text="${book?.explanation}"></textarea>
                </div>
            </div>

            <!-- 가격 및 재고 정보 -->
            <div class="form-section">
                <h5 class="section-title">가격 및 재고 정보</h5>
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">정가</label>
                            <div class="input-group">
                                <span class="input-group-text">₩</span>
                                <input type="number" class="form-control" id="originalPrice" name="regularPrice" th:value="${book?.regularPrice}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">판매가</label>
                            <div class="input-group">
                                <span class="input-group-text">₩</span>
                                <input type="number" class="form-control" id="salePrice" name="salePrice" th:value="${book?.salePrice}">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">할인율</label>
                            <div class="input-group">
                                <input type="number" class="form-control" id="discountRate" name="discountRate" th:value="${book?.discountRate}" readonly>
                                <span class="input-group-text">%</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">현재 재고</label>
                            <input type="number" class="form-control" name="product" th:value="${book?.product}">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">최소 재고</label>
                            <input type="number" class="form-control" name="minProduct" th:value="${book?.minProduct}">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">최대 재고</label>
                            <input type="number" class="form-control" name="maxProduct" th:value="${book?.maxProduct}">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 저장 버튼 -->
            <div class="d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-primary">변경사항 저장</button>
                <button type="button" class="btn btn-danger" onclick="if(confirm('정말로 이 상품을 삭제하시겠습니까?')) deleteProduct()">상품 삭제</button>
                <button type="button" class="btn btn-secondary" onclick="history.back()">취소</button>
            </div>
        </form>
    </div>
    
    <th:block layout:fragment="javascript">
        <script th:src="@{/js/admin-product.js}"></script>
        <script>
            // Set active menu
            const activeMenu = 'products';
            
            function deleteProduct() {
                // 현재 페이지의 URL에서 상품 ID 추출
                const pathParts = window.location.pathname.split('/');
                const productId = pathParts[pathParts.length - 1];
                
                // DELETE 요청을 위한 form 생성
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/admin/product/detail/${productId}`;
                document.body.appendChild(form);
                form.submit();
            }

        </script>
    </th:block>
</body>
</html>